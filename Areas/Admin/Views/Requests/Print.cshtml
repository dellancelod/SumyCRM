@using SumyCRM.Models
@model SumyCRM.Models.Request
@{
    Layout = null;

    var dt = Model.DateAdded.ToLocalTime();
    string dateStr = dt.ToString("dd.MM.yyyy");
    string timeStr = dt.ToString("HH:mm");

    string informedDate = Model.CustomerInformedOn?.ToString("yyyy-MM-dd") ?? "";
    string completedDate = Model.CompletedOn?.ToString("yyyy-MM-dd") ?? "";

    var facilities = ViewBag.Facilities as List<Facility> ?? new List<Facility>();
}
<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <title>Лист звернення №@Model.RequestNumber</title>

    <style>
        @@page {
            margin: 15mm;
        }

        body {
            font-family: "Times New Roman", serif;
            font-size: 14pt;
            color: #000;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .no-print {
            margin-bottom: 14px;
        }

        @@media print {
            .no-print {
                display: none !important;
            }
        }

        .center {
            text-align: center;
        }

        .row {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .mt-12 {
            margin-top: 12px;
        }

        .mt-18 {
            margin-top: 18px;
        }

        .mt-24 {
            margin-top: 24px;
        }

        .field-label {
            font-weight: 700;
        }

        .small {
            font-size: 12pt;
        }

        .line-input,
        .line-select,
        .line-date {
            width: 100%;
            border: none;
            border-bottom: 1px solid #000;
            outline: none;
            font: inherit;
            background: transparent;
            padding: 2px 2px 0 2px;
        }

            .line-input.smallw,
            .line-date.smallw {
                width: 120px;
            }

        .line-area {
            width: 100%;
            font: inherit;
            background: transparent;
            outline: none;
            border: none;
            line-height: 28px;
            padding: 4px 2px;
            background-image: linear-gradient(to bottom, transparent 27px, #000 27px, #000 28px);
            background-size: 100% 28px;
            background-repeat: repeat-y;
            resize: none;
            overflow: hidden;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .sig {
            width: 48%;
        }

        .sigline {
            width: 100%;
            border: none;
            border-bottom: 1px solid #000;
            background: transparent;
            height: 20px;
        }
    </style>
</head>

<body>
    <div class="no-print">
        <button type="button" onclick="window.print()">🖨️ Друкувати</button>
        <button type="button" onclick="window.close()">✖ Закрити</button>
        <button type="submit" form="printForm">💾 Зберегти</button>
    </div>

    <form id="printForm" method="post" action="/Admin/Requests/UpdatePrintFields">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.Id" />

        <div class="center">
            <b>СУМСЬКА МІСЬКА РАДА</b><br />
            <b>УПРАВЛІННЯ ТРАНСПОРТУ, ТРАНСПОРТНОЇ ІНФРАСТРУКТУРИ ТА ЗВ'ЯЗКУ</b><br />
            <b>Відділ «Інформаційний центр»</b>
        </div>

        <div class="mt-18 row">
            <div>
                <span class="field-label">№</span>
                <input class="line-input smallw" name="RequestNumber" value="@Model.RequestNumber" />
            </div>
            <div>
                <span class="field-label">Дата</span>
                <input class="line-input smallw" value="@dateStr" readonly />
            </div>
        </div>

        <div class="mt-12">
            <span class="field-label">Час</span>
            <input class="line-input smallw" value="@timeStr" readonly />
        </div>

        <div class="mt-18">
            <span class="field-label">ПІБ</span>
            <input class="line-input" name="Name" value="@Model.Name" />
        </div>

        <div class="mt-12">
            <span class="field-label">Адреса</span>
            <input class="line-input" name="Address" value="@Model.Address" />
        </div>

        <div class="mt-12">
            <span class="field-label">Телефон</span>
            <input class="line-input" name="Caller" value="@Model.Caller" />
        </div>

        <div class="mt-12">
            <span class="field-label">Виконавець</span>
            <select class="line-select" name="FacilityId">
                @foreach (var f in facilities)
                {
                    <option value="@f.Id" selected="@(f.Id == Model.FacilityId)">
                        @f.Name
                    </option>
                }
            </select>
        </div>

        <div class="mt-18">
            <span class="field-label">Зміст пропозицій, заявки, скарги</span>
            <textarea class="line-area" rows="5" name="Text">@Model.Text</textarea>
        </div>

        <div class="mt-12">
            <span class="field-label">Кому передано для виконання</span>
            <textarea class="line-area" rows="2" name="ForwardedTo">@Model.ForwardedTo</textarea>
        </div>

        <div class="mt-12">
            <span class="field-label">Інформація про хід виконання і завершення роботи</span>
            <textarea class="line-area" rows="5" name="ExecutionProgressInfo">@Model.ExecutionProgressInfo</textarea>
        </div>

        <div class="mt-12">
            <span class="field-label">Замовнику роз'яснено, повідомлено</span>
            <input type="date" class="line-date smallw" name="CustomerInformedOn" value="@informedDate" />
        </div>

        <div class="mt-12">
            <span class="field-label">Його відгук</span>
            <textarea class="line-area" rows="3" name="CustomerFeedback">@Model.CustomerFeedback</textarea>
        </div>

        <div class="mt-18">
            <span class="field-label">Дата виконання</span>
            <input type="date" class="line-date smallw" name="CompletedOn" value="@completedDate" />
        </div>

        <div class="mt-24">
            <div class="field-label">Головний спеціаліст відділу «Інформаційний центр»</div>

            <div class="mt-18 row">
                <div class="sig center">
                    <input class="sigline" />
                    <div class="small">(підпис)</div>
                </div>
                <div class="sig center">
                    <input class="sigline" />
                    <div class="small">(П.І.Б.)</div>
                </div>
            </div>
        </div>

        <div class="no-print mt-18">
            <button type="submit">💾 Зберегти</button>
        </div>
    </form>
</body>
</html>
